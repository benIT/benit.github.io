<!DOCTYPE html>
<html>
    <head>
        <title>Home &mdash; benIT&#039;s notebook &mdash; </title>
        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <meta name="robots" content="noindex, follow">
                <link href="/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <link rel="apple-touch-startup-image" href="/images/jackson/2048x2048.png">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="shortcut icon" sizes="76x76" href="/images/jackson/76x76.png">
        <link rel="shortcut icon" sizes="120x120" href="/images/jackson/120x120.png">
        <link rel="shortcut icon" sizes="128x128" href="/images/jackson/128x128.png">
        <link rel="shortcut icon" sizes="152x152" href="/images/jackson/152x152.png">
        <link rel="shortcut icon" sizes="196x196" href="/images/jackson/196x196.png">
        <link rel="shortcut icon" sizes="512x512" href="/images/jackson/512x512.png">
        <link rel="shortcut icon" sizes="1024x1024" href="/images/jackson/1024x1024.png">
        <link rel="shortcut icon" sizes="2048x2048" href="/images/jackson/2048x2048.png">
        <link rel="apple-touch-icon" sizes="76x76" href="/images/jackson/76x76.png">
        <link rel="apple-touch-icon" sizes="120x120" href="/images/jackson/120x120.png">
        <link rel="apple-touch-icon" sizes="128x128" href="/images/jackson/128x128.png">
        <link rel="apple-touch-icon" sizes="152x152" href="/images/jackson/152x152.png">
        <link rel="apple-touch-icon" sizes="196x196" href="/images/jackson/196x196.png">
        <link rel="apple-touch-icon" sizes="512x512" href="/images/jackson/512x512.png">
        <link rel="apple-touch-icon" sizes="1024x1024" href="/images/jackson/1024x1024.png">
        <link rel="apple-touch-icon" sizes="2048x2048" href="/images/jackson/2048x2048.png">

        <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="benIT&#039;s notebook activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        </style>
                                    </head>
    <a href="https://github.com/benIT/github-blog"><img style="z-index:1032;position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
    <body>
        <header>
            <nav class="navbar navbar-inverse navbar-fixed-top">
                <div class="container">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="/">benIT&#039;s notebook </a>
                    </div>
                    <div id="navbar" class="collapse navbar-collapse">
                        <ul class="nav navbar-nav">
                            <li><a href="https://github.com/benIT">Github</a></li>
                            <li><a href="/blog">Posts Archive</a></li>
                            <li><a href="/blog/categories">Categories</a></li>
                            <li><a href="/atom.xml">RSS feed</a></li>
                            <!--<li><a href="/blog/tags">Tags</a></li>-->
                            <li><a href="/about">About</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span8">
                        <article>
        <header>
            <h2><a href="/blog/2020/09/16/git-bfg">Clean your git repo with BFG Repo-Cleaner</a></h2>
        </header>
        <div>
            <p>Use case : delete the <code>medias</code> from my git repo that contains huge files.</p>

<p>Download bgf.jar from https://rtyley.github.io/bfg-repo-cleaner/</p>

<pre><code>git clone --mirror https://git.mycompany.com/myrepo.git

java -jar ../bfg-1.13.0.jar --delete-folders medias myrepo.git

cd myrepo.git

git reflog expire --expire=now --all &amp;&amp; git gc --prune=now --aggressive

git push
</code></pre>

<p>Size 400Mo -> 30 Mo</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/blog/2020/04/17/linux-startup">linux basics: startup</a></h2>
        </header>
        <div>
            <p>init: parent of all ps. PID=0</p>

<p>stages</p>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="/blog/2020/04/17/linux-quotas">linux basics: quotas</a></h2>
        </header>
        <div>
            <h2 id="quotas">quotas</h2>

<p>Quota specifications:</p>

<ul>
<li>number of inode (inode: pointer to file)</li>
<li>number of block</li>
</ul>

<p>Types:</p>

<ul>
<li>hard: block user when quota is reached</li>
<li>soft: inform user that is about to reached the quota</li>
</ul>

<h3 id="install-quotas">install quotas</h3>

<pre><code>apt install quota
</code></pre>

<h3 id="enable-quotas">Enable quotas</h3>

<h4 id="%C2%A0check-config-supports-quota">Â Check config supports quota</h4>

<pre><code>grep QUOTA /boot/config-*
</code></pre>

<p>=></p>

<pre><code>CONFIG_NFT_QUOTA=m
CONFIG_NETFILTER_XT_MATCH_QUOTA=m
CONFIG_XFS_QUOTA=y
CONFIG_QUOTA=y
CONFIG_QUOTA_NETLINK_INTERFACE=y
CONFIG_PRINT_QUOTA_WARNING=y
# CONFIG_QUOTA_DEBUG is not set
CONFIG_QUOTA_TREE=m
CONFIG_QUOTACTL=y
CONFIG_QUOTACTL_COMPAT=y
</code></pre>

<h4 id="mount-options">Mount options</h4>

<p>Check quota are enable in /etc/fstab at the 4th column: <code>usrquota</code>, <code>grpquota</code> option must be specified:</p>

<pre><code>UUID=e248b430-aed3-4586-8a9f-2444515376e7 /               ext4    errors=remount-ro,acl,usrquota,grpquota 0 
</code></pre>

<h3 id="enable">Enable</h3>

<pre><code>quotacheck -ugm /
</code></pre>

<p>check quota files have been created:</p>

<pre><code>ls /aquota.*
/aquota.group  /aquota.user
</code></pre>

<p>this will fix the following error: <code>edquota: Cannot open quotafile //aquota.user: No such file or directory No filesystems with quota detected.</code></p>

<p>turn it on:</p>

<pre><code>quotaon -v /
</code></pre>

<p>=></p>

<pre><code>/dev/sda1 [/]: group quotas turned on
/dev/sda1 [/]: user quotas turned on
</code></pre>

<h3 id="quota-commands">Quota commands</h3>

<p>check quotas:</p>

<pre><code>quotacheck -a
</code></pre>

<p>display all quotas:</p>

<pre><code>repquota -a 
</code></pre>

<p>edit quota:</p>

<p>** do not edit <code>/etc/quotatab</code> file directly but use:</p>

<pre><code>edquota -u foo
edquota -g foogrp
</code></pre>

<h3 id="edit-grace-period">edit grace period</h3>

<p>grace period is the quantity of time that the system allows you to exceed the soft limit without blocking you.
After that, user will be considered as he exceeded the hard limit.</p>

<pre><code>edquota -t
</code></pre>

<h3 id="service">Service</h3>

<pre><code>/etc/init.d/quota start
service quota start
</code></pre>

<h2 id="test-it-%21">Test it !</h2>

<h3 id="as-root">As root</h3>

<pre><code>Disk quotas for user foo (uid 1001):
  Filesystem                   blocks       soft       hard     inodes     soft     hard
  /dev/sda1                        16          0          0          4        5        6          
</code></pre>

<p>Here, our foo user has:
* currently consumed 4 inodes on the FS
* a quota soft limit set to 5 inodes
* a quota hard  limit set to 6 inodes</p>

<h3 id="as-final-user">As final user</h3>

<h4 id="reach-the-soft-limit">Reach the soft limit</h4>

<pre><code>foo@debian:~$ touch file 
foo@debian:~$ touch file 2
sda1: warning, user file quota exceeded.
</code></pre>

<h4 id="reach-the-hard-limit">Reach the hard limit</h4>

<pre><code>foo@debian:~$ touch file 3
sda1: write failed, user file limit reached.
touch: cannot touch '3': Disk quota exceeded
</code></pre>

<h3 id="report">Report</h3>

<pre><code>root@debian:~# repquota /
</code></pre>

<p>=></p>

<pre><code>*** Report for user quotas on device /dev/sda1
Block grace time: 7days; Inode grace time: 7days
                        Block limits                File limits
User            used    soft    hard  grace    used  soft  hard  grace
----------------------------------------------------------------------
root      -- 3645544       0       0         113922     0     0       
man       --    1496       0       0            157     0     0       
lp        --   11980       0       0              1     0     0       
_apt      --      12       0       0              3     0     0       
systemd-timesync --       4       0       0              2     0     0       
avahi-autoipd --       4       0       0              1     0     0       
speech-dispatcher --       4       0       0              1     0     0       
colord    --       8       0       0              2     0     0       
lightdm   --      32       0       0              8     0     0       
ben       --   56020       0       0           1295     0     0       
foo       -+      16       0       0              6     5     6  6days
</code></pre>

<h2 id="resources">Resources</h2>

<ul>
<li>https://www.digitalocean.com/community/tutorials/how-to-set-filesystem-quotas-on-debian-10</li>
</ul>

        </div>
            </article>
    <nav>
        <ul class="pager">
            <li class="next"><a href="/page/4">Older posts<span aria-hidden="true">&rarr;</span></a></li>            <li class="previous"><a href="/page/2"><span aria-hidden="true">&larr;</span> Newer posts</a></li>        </ul>
    </nav>
                </div>
                <!--<div class="span4 sidebar">-->
                    <!--<div class="well">-->
                        <!--<h4>benIT&#039;s notebook</h4>-->
                    <!--</div>-->
                    <!--<div class="well sidebar-nav">-->
                        <!--<h4>Links</h4>-->
                        <!--<ul class="nav">-->
                            <!--<li><a href="http://sculpin.io">sculpin.io</a></li>-->
                            <!--<li><a href="http://twitter.com/getsculpin">@getsculpin</a></li>-->
                        <!--</ul>-->
                    <!--</div>-->
                <!--</div>-->
            </div>
        </div>
        <footer class="container">
            &copy; 2021 benIT&#039;s notebook
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/components/jquery/jquery.min.js"><\/script>')</script>
        <script src="/components/bootstrap/js/bootstrap.min.js"></script>
                
                <script src="/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

                    </body>
</html>
